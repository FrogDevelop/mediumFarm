import{TonConnect as tt}from"https://cdn.jsdelivr.net/npm/@tonconnect/sdk@latest/+esm";class et{constructor(){this.connector=new tt({manifestUrl:"https://your-site.com/tonconnect-manifest.json"}),this.account=null}async connect(){try{if(this.connector.connected)return this.account=this.connector.account,this.account;const e=await this.connector.getWallets();if(!e.length)throw new Error("No wallets available");const n=this.connector.connect(e[0]);return window.open(n,"_blank"),new Promise(o=>{this.connector.onStatusChange(i=>{i&&(this.account=i,o(i))})})}catch(e){throw console.error("Connection error:",e),e}}async getBalance(){if(!this.account)throw new Error("Wallet not connected");return"100.00"}}var Z;const $=(Z=window.Telegram)==null?void 0:Z.WebApp;function nt(t){return t>=1e3?"Legend":t>=500?"Veteran":t>=200?"Experienced":t>=100?"Intermediate":t>=50?"Beginner":"Newbie"}function ot(t){return"zip_shishka.png"}$&&($.isExpanded||$.expand(),document.documentElement.style.height=`${$.viewportHeight}px`,document.body.style.height=`${$.viewportHeight}px`);let p=parseInt(localStorage.getItem("darknetReputation"))||0;localStorage.getItem("darknetUnlocked");let b=parseInt(localStorage.getItem("playerMoney"))||500;parseInt(localStorage.getItem("shishCount"));let c=JSON.parse(localStorage.getItem("inventory"))||{},_,R=!1,N=!1,P=!1,O=!1;const q={},D=document.querySelector(".money"),J=[{id:"zip",name:"Зип пакет",price:5,type:"zip",image:"zip.png",description:"Плотный пакет для хранения шишек.",displayName:"зип-пакетов",quantitySelectable:!0},{id:"fertilizer",name:"Удобрение",price:500,type:"fertilizer",image:"fertilizer.png",description:"Органическое удобрение для ускорения роста кустов.",displayName:"удобрений",quantitySelectable:!0},{id:"plant_food",name:"Еда для куста",price:400,type:"plant_food",image:"plant_food.png",description:"Специальное питание для растения.",displayName:"еды для куста",quantitySelectable:!0},{id:"super_food",name:"Супер-питание",price:3e3,type:"super_food",image:"super_food.png",description:"Легендарная добавка для растений.",displayName:"супер-питаний",quantitySelectable:!0},{id:"rare_fertilizer",name:"Редкий удобритель",price:300,type:"rare_fertilizer",image:"rare_fertilizer.png",description:"Эксклюзивный продукт для максимального эффекта.",displayName:"редких удобрителей",quantitySelectable:!0}],it={growthBoost:{name:"Ускоренный рост",icon:"fertilizer.png",duration:120,description:"Растения растут в 2 раза быстрее",activate:function(){R=!0}},yieldBoost:{name:"Увеличенный урожай",icon:"plant_food.png",duration:60,description:"+1 шишка за сбор (всегда)",activate:function(){N=!0}},rareHarvest:{name:"Редкий урожай",icon:"rare_fertilizer.png",duration:120,description:"50% шанс получить +1 шишку",activate:function(){P=!0}},superFood:{name:"Супер питание",icon:"super_food.png",duration:30,description:"10% шанс получить 5 шишек вместо 1",activate:function(){O=!0}}};function u(t,e=!1){let n=document.getElementById("notification-container");n||(n=document.createElement("div"),n.id="notification-container",document.body.appendChild(n));const o=document.createElement("div");o.className=`notification ${e?"error":""}`,o.textContent=t,n.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.animation="slideInFromLeft 0.3s ease-out forwards"},10),setTimeout(()=>{o.style.animation="fadeOutToLeft 0.3s ease-in forwards",setTimeout(()=>o.remove(),300)},1e3)}function at(t){if(Object.keys(q).length>=1)return u("Можно активировать только один бафф за раз!",!0),!1;const e=it[t];if(!e)return!1;const n=document.getElementById("buff-status-container");if(!n)return!1;const o=document.createElement("div");o.className="buff-item",o.id=`buff-${t}`,o.innerHTML=`
        <img src="${e.icon}" alt="${e.name}" class="buff-icon">
        <div class="buff-timer">${Math.floor(e.duration/60)}:${(e.duration%60).toString().padStart(2,"0")}</div>
    `,n.appendChild(o);const i=Date.now()+e.duration*1e3;function a(){const d=Math.max(0,Math.floor((i-Date.now())/1e3)),v=String(Math.floor(d/60)).padStart(2,"0"),M=String(d%60).padStart(2,"0");o.querySelector(".buff-timer").textContent=`${v}:${M}`,d<=0&&(clearInterval(l),o.remove(),delete q[t],st(t),u(`Бафф "${e.name}" закончился`))}const l=setInterval(a,1e3);return q[t]={interval:l,element:o},e.activate(),!0}function st(t){switch(t){case"growthBoost":R=!1;break;case"yieldBoost":N=!1;break;case"rareHarvest":P=!1;break;case"superFood":O=!1;break}console.log(`Баф "${t}" деактивирован.`)}function z(t,e,n,o){if(!c[t]||c[t].count<1){u("Недостаточно предметов!",!0);return}if(Object.keys(q).length>0){u("Нельзя активировать несколько бафов одновременно!",!0);return}at(n)&&(u(o),E(t,1))}function ct(t){z(t,"fertilizer","growthBoost","Удобрение применено! Растения растут в 2 раза быстрее.")}function rt(t){z(t,"plant_food","yieldBoost","Еда для куста применена! +1 шишка за каждый сбор.")}function lt(t){z(t,"rare_fertilizer","rareHarvest","Редкий удобритель использован! 50% шанс получить дополнительную шишку.")}function dt(t){z(t,"super_food","superFood","Супер-питание применено! 10% шанс получить 5 шишек вместо 1.")}document.addEventListener("touchstart",function(t){t.touches.length>1&&t.preventDefault()},{passive:!1});function S(){if(D){let i=function(a){o||(o=a);const l=a-o,d=Math.min(l/n,1);D.textContent=t+Math.round(e*d),l<n&&window.requestAnimationFrame(i)};const t=parseInt(D.textContent),e=b-t,n=500;let o=null;window.requestAnimationFrame(i)}}function L(){if(!_)return;_.innerHTML="";let t=0;for(const[e,n]of Object.entries(c)){if(t>=15)break;const o=document.createElement("div");o.classList.add("inventory-item"),o.dataset.itemId=e;const i=document.createElement("img");i.src=ut(e),i.alt=(n==null?void 0:n.name)||"";const a=document.createElement("div");a.classList.add("item-count"),a.textContent=typeof n=="object"&&(n!=null&&n.count)?`x${n.count}`:"x0",o.append(i,a),o.addEventListener("click",()=>pt(e,o)),_.appendChild(o),t++}for(;t<15;)_.appendChild(document.createElement("div")).classList.add("inventory-item"),t++}function ut(t){return{shishka:"bud.png",fertilizer:"fertilizer.png",zip:"zip.png",zip_shishka:"zip_shishka.png",plant_food:"plant_food.png",pot:"pot.png",booster:"booster.png",rare_fertilizer:"rare_fertilizer.png",super_food:"super_food.png"}[t]||"bud.png"}function pt(t,e){var a;const n=c[t];if(!n)return;const o=[],i={fertilizer:()=>ct(t),plant_food:()=>rt(t),rare_fertilizer:()=>lt(t),super_food:()=>dt(t)};i[n.type]&&o.push({label:"Применить",action:i[n.type]}),t==="mixer_machine"&&o.push({label:"Использовать",action:()=>openMixerInterface()}),n.type==="zip"&&((a=c.shishka)==null?void 0:a.count)>=5&&o.push({label:"Расфасовать",action:()=>ht(t)},{label:"Расфасовать все",action:()=>gt(t)}),mt(o,e)}function mt(t,e){const n=document.getElementById("action-menu");if(n){if(n.innerHTML="",t.length===0){n.classList.add("hidden");return}t.forEach(o=>{const i=document.createElement("button");i.className="action-button",i.textContent=o.label,i.addEventListener("click",()=>{o.action(),K()}),n.appendChild(i)}),ft(n,e)}}function ft(t,e){const n=e.getBoundingClientRect();t.style.visibility="hidden",t.classList.remove("hidden");const o=t.getBoundingClientRect(),i=window.innerWidth,a=window.innerHeight,l={right:{left:n.right+5,top:Math.min(n.top,a-o.height-10)},left:{left:n.left-o.width-5,top:Math.min(n.top,a-o.height-10)},bottom:{left:Math.max(10,Math.min(n.left,i-o.width-10)),top:n.bottom+5}};let d=l.right;l.right.left+o.width>i&&(l.left.left>=10?d=l.left:d=l.bottom),d.left=Math.max(10,Math.min(d.left,i-o.width-10)),d.top=Math.max(10,Math.min(d.top,a-o.height-10)),t.style.cssText=`
        position: fixed;
        left: ${d.left}px;
        top: ${d.top}px;
        opacity: 1;
        transform: scale(1);
        z-index: 100000;
        visibility: visible;
    `}function K(){const t=document.getElementById("action-menu");t&&t.classList.add("hidden")}document.addEventListener("click",t=>{const e=document.getElementById("action-menu");e&&!e.contains(t.target)&&!t.target.closest(".inventory-item")&&K()});function ht(t){var e,n;((e=c.shishka)==null?void 0:e.count)>=5&&((n=c[t])==null?void 0:n.count)>=1?(E("shishka",5),E(t,1),c.zip_shishka||(c.zip_shishka={count:0,type:"packed_product",name:"Zip с шишкой"}),c.zip_shishka.count+=1,C(),L()):u("Не хватает шишек или zip пакетов!",!0)}function gt(t){const e=c.shishka,n=c[t];if(!e||!n){u("Нет шишек или zip пакетов!",!0);return}const o=Math.min(Math.floor(e.count/5),n.count);if(o===0){u("Не хватает шишек или zip пакетов для расфасовки!",!0);return}E("shishka",o*5),E(t,o),c.zip_shishka||(c.zip_shishka={count:0,type:"packed_product",name:"Zip с шишкой"}),c.zip_shishka.count+=o,C(),L(),u(`Успешно упаковано ${o} пакетов!`)}function E(t,e){c[t]&&(c[t].count-=e,c[t].count<=0&&delete c[t],C(),L())}function C(){localStorage.setItem("inventory",JSON.stringify(c))}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("inventar_button"),e=document.getElementById("inventory-modal"),n=document.getElementById("close-inventory");_=document.querySelector(".inventory-items");const o=document.getElementById("shop_button"),i=document.getElementById("shop-modal"),a=document.getElementById("close-shop-button"),l=document.querySelector(".shop-items"),d=document.querySelectorAll(".bud");document.getElementById("darknet_button");function v(){i&&(i.classList.add("open"),r(),S())}function M(){i&&i.classList.remove("open"),S()}function r(){l&&(l.innerHTML="",J.forEach(s=>{const f=document.createElement("div");f.classList.add("shop-item"),f.dataset.itemId=s.id,f.innerHTML=`
                <div class="img-cnt"><img src="${s.image}" alt="${s.name}"></div>
                <div class="item-info">
                    <div class="item-name">${s.name}</div>
                    <div class="item-description">${s.description}</div>
                    <div class="item-price">Цена: ${s.price} $</div>
                </div>
                <div class="buy-conteiner">
                    <button class="buy-button">Купить</button>
                    <div class="quantity-controls">
                        <button class="quantity-button minus">-</button>
                        <div class="quantity">1</div>
                        <button class="quantity-button plus">+</button>
                    </div>
                </div>
            `,l.appendChild(f)}))}t&&e&&t.addEventListener("click",()=>{e.classList.add("open"),L()}),n&&e&&n.addEventListener("click",()=>e.classList.remove("open")),o&&o.addEventListener("click",v),a&&a.addEventListener("click",()=>{M();const s=document.getElementById("inventory-modal");s&&s.classList.remove("open")});function g(s){s&&(W(s),s.style.cssText="opacity: 1; transform: scale(1);",setTimeout(()=>s.classList.add("active"),50))}function h(s){var f;!((f=s==null?void 0:s.classList)!=null&&f.contains("active"))||s.classList.contains("collecting")||(s.classList.add("collecting"),W(s),setTimeout(()=>{s.classList.remove("collecting"),s.style.cssText="transform: scale(0); opacity: 0;";let x=1;N&&(x+=1),P&&Math.random()<.5&&(x+=1),O&&Math.random()<.1&&(x+=4),c.shishka||(c.shishka={count:0,type:"product",name:"Шишка"}),c.shishka.count+=x,C(),L(),setTimeout(()=>g(s),R?1e3:5e3)},1e3))}function W(s){if(!(s!=null&&s.parentElement))return;const f=document.createElement("div");f.className="leaves";const x=s.getBoundingClientRect(),A=s.parentElement.getBoundingClientRect();f.style.cssText=`
            position: absolute;
            left: ${x.left-A.left}px;
            top: ${x.top-A.top}px;
        `;for(let U=0;U<4;U++){const B=document.createElement("div");B.className="leaf",B.style.setProperty("--x",`${Math.random()*40-20}px`),B.style.setProperty("--y",`${Math.random()*-40}px`),f.appendChild(B)}s.parentElement.appendChild(f),setTimeout(()=>f.remove(),500)}d.forEach(s=>{g(s),s.addEventListener("click",()=>h(s))}),S()});document.addEventListener("click",function(t){var e;if(t.target.classList.contains("plus")){const n=t.target.closest(".quantity-controls");if(n){const o=n.querySelector(".quantity");if(o){let i=parseInt(o.textContent)||1;o.textContent=i+1}}}if(t.target.classList.contains("minus")){const n=t.target.closest(".quantity-controls");if(n){const o=n.querySelector(".quantity");if(o){let i=parseInt(o.textContent)||1;i>1&&(o.textContent=i-1)}}}if(t.target.classList.contains("buy-button")){const n=t.target.closest(".shop-item");if(n){const o=n.dataset.itemId,i=parseInt((e=n.querySelector(".quantity"))==null?void 0:e.textContent)||1;yt(o,i,t)}}});function yt(t,e,n){const o=J.find(a=>a.id===t);if(!o)return;const i=o.price*e;if(b>=i){b-=i,c[t]||(c[t]={count:0,type:t,name:o.name}),c[t].count+=e,C(),localStorage.setItem("playerMoney",b),S(),L();let a;e===1?a=o.name.toLowerCase():a=o.displayName||`${o.name.toLowerCase()}ов`,u(`Куплено ${e} ${a} за ${i}$`),n!=null&&n.target&&(n.target.textContent="Куплено!",setTimeout(()=>{n.target&&(n.target.textContent="Купить")},1e3))}else u("Недостаточно денег!",!0)}const vt=(()=>{let t={};const e={chats:{title:"Чаты",init:o},darknet:{title:"Darknet",init:G}};function n(){t={phoneModal:document.getElementById("phone-modal"),homeScreen:document.querySelector(".home-screen"),appScreen:document.querySelector(".app-screen"),appTitle:document.querySelector(".app-title"),appContent:document.querySelector(".app-content"),closeBtn:document.querySelector(".close-phone-button"),darknetButton:document.getElementById("darknet_button")}}function o(){t.appContent&&(t.appContent.innerHTML=`
            <div class="chat-list">
                <div class="chat-item" data-contact="uncle">
                    <img src="uncle.png" alt="Дядя Реджи">
                    <span>Дядя Реджи</span>
                </div>
                <div class="chat-item" data-contact="sylvester">
                    <img src="sylvester.png" alt="Сильвестр">
                    <span>Сильвестр</span>
                </div>
            </div>
        `,setTimeout(()=>{const r=document.querySelectorAll(".chat-item");r.length&&r.forEach(g=>{g.addEventListener("click",function(){const h=this.dataset.contact;i(h)})})},0))}function i(r){t.appContent&&(t.appContent.innerHTML=`
            <div class="chat-window">
                <div class="messages"></div>
                <div class="reply-buttons"></div>
            </div>
        `,r==="uncle"?Et():r==="sylvester"&&startChatWithSylvester())}function a(r){!e[r]||!t.appTitle||!t.appContent||(t.appTitle.textContent=e[r].title,e[r].init(),t.homeScreen.style.display="none",t.appScreen.style.display="block")}function l(){!t.homeScreen||!t.appScreen||(t.homeScreen.style.display="block",t.appScreen.style.display="none")}function d(){t.phoneModal&&(t.phoneModal.style.display="flex",t.phoneModal.classList.remove("closing"),setTimeout(()=>{t.phoneModal.classList.add("open")},10),l())}function v(){t.phoneModal&&(t.phoneModal.classList.add("closing"),t.phoneModal.classList.remove("open"),setTimeout(()=>{t.phoneModal.style.display="none",t.phoneModal.classList.remove("closing")},400))}document.addEventListener("DOMContentLoaded",()=>{vt.init()}),document.querySelectorAll(".phone-app");function M(){n();const r=document.querySelector(".phone-apps");if(r&&!document.querySelector('.phone-app[data-app="darknet"]')){const h=document.createElement("div");h.className="phone-app",h.dataset.app="darknet",h.style.backgroundColor="#000",h.innerHTML=`
                <img src="darknet.png" alt="Darknet">
            `,r.appendChild(h)}t.closeBtn&&t.closeBtn.addEventListener("click",v),document.querySelectorAll(".phone-app").forEach(h=>{h.addEventListener("click",function(){a(this.dataset.app)})});const g=document.querySelector(".back-button");g&&g.addEventListener("click",l),t.darknetButton&&t.darknetButton.addEventListener("click",d)}return{init:M,open:d,close:v}})();function kt(){localStorage.setItem("darknetUnlocked","true");const t=document.querySelector(".phone-apps");if(t){const e=document.createElement("div");e.className="phone-app",e.dataset.app="darknet",e.style.backgroundColor="#000",e.innerHTML=`
            <img src="darknet.png" alt="Darknet">
        `,t.appendChild(e),e.addEventListener("click",function(){openApp("darknet")})}k("uncle","Вот тебе доступ к Darknet Market. Будь осторожен!"),k("system","Darknet Market теперь доступен в вашем телефоне")}let w=parseInt(localStorage.getItem("uncleDeals"))||0;const Q=5;let H=localStorage.getItem("uncleStoppedBuying")==="true",m=parseInt(localStorage.getItem("currentDealPrice"))||0;m===0&&(m=F(),localStorage.setItem("currentDealPrice",m));const V={uncle:{start:{message:"Ну что, мелкий, есть чем поделиться?",replies:[{text:"Продать через даркнет",next:"darknet_advice"},{text:"Продать тебе",condition:()=>w<Q,next:"selling_options"},{text:"Ничего",next:null}]},darknet_advice:{message:"Darknet - рискованно, но прибыльно. Риск конфискации 30%, но цены в 2-3 раза выше.",replies:[{text:"Понял",next:"start"}]},selling_options:{message:`Сколько скинешь? (${F()}$ за упаковку)`,replies:[{text:"Не жмоть, давай нормально",action:()=>bt()},{text:"5 упаковок",condition:()=>{var t;return((t=c.zip_shishka)==null?void 0:t.count)>=5},action:()=>j(5)},{text:"Все что есть",condition:()=>{var t;return((t=c.zip_shishka)==null?void 0:t.count)>0},action:()=>j(c.zip_shishka.count)},{text:"Передумал",next:"start"}]},darknet_offer:{message:"Хочешь научиться продавать через даркнет? Там цены в 2 раза выше, но и риск соответствующий.",replies:[{text:"Расскажи подробнее",next:"darknet_explain"},{text:"Не сейчас",next:"start"}]},darknet_explain:{message:"Тебе понадобится: 1) Тор браузер 2) Криптовалюта 3) Репутация. Когда будешь готов - заходи.",replies:[{text:"Я готов сейчас",action:()=>kt()},{text:"Понял, позже",next:"start"}]},darknet_explain:{message:function(){return p<5?"Тебе понадобится: 1) Тор браузер 2) Криптовалюта 3) Репутация. Начни с малого.":`Твоя репутация: ${p}/10. Продолжай в том же духе!`},replies:[{text:"Как повысить репутацию?",next:"reputation_help"},{text:"Понял, позже",next:"start"}]},reputation_help:{message:"Репутация растет при успешных сделках. Чем больше продашь - тем лучше цены и ниже риски.",replies:[{text:"Спасибо за совет",next:"start"}]}}};function Mt(){localStorage.setItem("uncleDeals",w),localStorage.setItem("currentDealPrice",m)}function F(){return m=Math.floor(Math.random()*16)+15,m}function Et(){if(H){k("uncle","Я больше не покупаю товар. Осваивай даркнет!"),T("uncle","darknet_offer");return}F(),T("uncle","start")}function T(t,e,n=null){const o=n||V[t][e];o&&(k(t,o.message),o.replies&&xt(o.replies))}function xt(t){const e=document.querySelector(".reply-buttons");e&&(e.innerHTML="",t.forEach(n=>{if(n.condition&&!n.condition())return;const o=document.createElement("button");o.textContent=n.text,o.addEventListener("click",()=>{k("user",n.text),e.innerHTML="",setTimeout(()=>{n.next?T("uncle",n.next):n.action&&n.action()},800)}),e.appendChild(o)}))}function j(t){if(H)return;const e=t*m;E("zip_shishka",t),b+=e,w++,localStorage.setItem("uncleDeals",w),S(),C(),u(`Продано ${t} упаковок по ${m}$ = ${e}$`,!1),k("uncle","Деньги перевел! Не забывай, я не смогу постоянно приносить тебе деньги, слишком много рисков!"),w>=Q&&(H=!0,localStorage.setItem("uncleStoppedBuying","true"),setTimeout(()=>{u("Дядя Реджи больше не покупает товар. Используйте даркнет!",!1),k("uncle","Всё, хватит! Больше не буду покупать."),setTimeout(()=>T("uncle","darknet_offer"),1500)},2e3))}function bt(){Math.random()>.5?(m+=5,k("uncle",`Ладно, сегодня добрый - дам ${m}$!`)):(m=Math.max(15,m-3),k("uncle",`Нет, так уж и быть - ${m}$ и точка!`)),document.querySelector(".reply-buttons").innerHTML="",Mt(),setTimeout(()=>{const e={message:`Итак, по ${m}$ за упаковку. Сколько скинешь?`,replies:V.uncle.selling_options.replies};T("uncle","selling_options",e)},1e3)}function k(t,e){const n=document.querySelector(".messages");if(!n)return;const o=document.createElement("div");o.className=`message ${t==="user"?"user":"npc"}`,o.innerHTML=`
        <div class="message-text">${e}</div>
    `,n.appendChild(o),n.scrollTop=n.scrollHeight}const y=[];function X(){const e=Math.floor(Math.random()*30),n=p*3;return Math.round(Math.min(100,50+e+n)*10)/10}let I=null;function St(){const t=document.getElementById("priceChart");t&&(I&&(I.destroy(),I=null),I=new Chart(t.getContext("2d"),{type:"line",data:{labels:y.map((e,n)=>`Тик ${n+1}`),datasets:[{label:"Цена на шишки ($)",data:y,borderColor:"limegreen",borderWidth:2,fill:!1,tension:.2}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!1,ticks:{callback:function(e){return e+"$"}}}}}}))}function G(){var v,M;const t=Y("zip_shishka"),e=Math.round(X()*10)/10,n=Math.round(Math.max(5,30-p*2)*10)/10,o=Math.round(p*10)/10;y.push(t),y.length>10&&y.shift();const i=document.querySelector(".app-content");i.innerHTML=`
        <div class="darknet-app">
            <div class="darknet-header">
                <h2>🕶️ DARKNET MARKET v3.2</h2>
                <p>Репутация: ${o}/20</p>
                <div class="darknet-rep">${nt(p)}</div>
                <div class="tor-status">${Ct()}</div>
            </div>
            
            <div class="chart-container" style="height: 200px; position: relative;">
                <canvas id="priceChart"></canvas>
            </div>

            <div class="market-item">
                <img src="${ot()}" alt="Пакет шишек" style="height: 60px;">
                <div class="item-name">Пакет шишек</div>
                <div class="item-price">Цена: ${t}$ (${Lt()}) [15-30$]</div>
                <div class="item-demand">Спрос: ${e}%</div>
                <div class="item-risk">Риск: ${n}%</div>
                <div class="item-inventory">У вас: ${((v=c.zip_shishka)==null?void 0:v.count)||0} шт.</div>
                <div class="quantity-selector">
                    <button id="decrease-qty">-</button>
                    <input type="text" id="sell-quantity" value="1" readonly />
                    <button id="increase-qty">+</button>
                </div>
                <button class="darknet-button" id="sell-shishka">Продать</button>
            </div>
        </div>
    `,setTimeout(()=>{St()},50);let a=1;const l=((M=c.zip_shishka)==null?void 0:M.count)||0,d=document.getElementById("sell-quantity");document.getElementById("decrease-qty").addEventListener("click",()=>{a>1&&(a--,d.value=a)}),document.getElementById("increase-qty").addEventListener("click",()=>{a<l&&(a++,d.value=a)}),document.getElementById("sell-shishka").addEventListener("click",()=>{const r=a;r>0&&$t("zip_shishka",r)})}function Y(t){const e={zip_shishka:20},n=p*2,o=Math.floor(Math.random()*11)-5,i=X()/20,a=e[t]+n+o+i;return Math.round(Math.max(15,Math.min(30,a))*10)/10}function Lt(){if(y.length<2)return"↔";const t=y[y.length-1],e=y[y.length-2];return t>e?"↑":t<e?"↓":"↔"}function Ct(){const t=["TOR: Secure Connection","TOR: Relay Active","TOR: 3 Hops","TOR: Anonymous","TOR: Bridge Connected"];return t[Math.floor(Math.random()*t.length)]}function $t(t,e){if(!c[t]||c[t].count<e){u("Недостаточно товара!",!0);return}const n=Math.round(Y(t)*10)/10,o=Math.min(20,e*2),i=Math.round(Math.max(5,30-p*2+o)*10)/10,a=Math.round(n*e*10)/10;Math.random()*100<i?(E(t,e),u(`Провал! Товар конфискован полицией. (Риск: ${i}%)`,!0),p=Math.round(Math.max(0,p-.3)*10)/10,localStorage.setItem("darknetReputation",p)):(E(t,e),b+=a,p=Math.round(Math.min(20,p+e*.2)*10)/10,localStorage.setItem("darknetReputation",p),localStorage.setItem("playerMoney",b),u(`Успешно продано ${e} шт. за ${a}$ (Риск: ${i}%)`),S(),G())}document.addEventListener("DOMContentLoaded",()=>{var e,n;const t=(e=window.Telegram)==null?void 0:e.WebApp;t&&(t.expand(),console.log("Telegram WebApp v"+t.version+" initialized",{platform:t.platform,viewportHeight:t.viewportHeight,user:(n=t.initDataUnsafe)==null?void 0:n.user}))});window.addEventListener("load",()=>{const t=document.getElementById("loading-screen");t&&setTimeout(()=>{t.classList.add("loaded"),setTimeout(()=>{t.remove()},500)},5e3),delete c.mixer_machine,delete c.light});document.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("connectBtn"),e=document.getElementById("walletInfo"),n=new et;t.addEventListener("click",async()=>{try{const o=await n.connect();if(!o)throw new Error("Connection failed");const i=await n.getBalance();e.innerHTML=`
                <p>Connected: ${_t(o.address)}</p>
                <p>Balance: ${i} TON</p>
            `}catch(o){e.innerHTML=`
                <p style="color: red">Error: ${o.message}</p>
                <button onclick="location.reload()">Retry</button>
            `}})});function _t(t){return t?`${t.slice(0,4)}...${t.slice(-4)}`:"null"}
